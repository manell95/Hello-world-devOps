name: Deploy to AWS

on:
  push:
    branches: [ main, master ]
  pull_request:
    branches: [ main, master ]

jobs:
  deploy:
    runs-on: ubuntu-latest
    
    steps:
    # 1. Checkout du code
    - name: ğŸ“¥ Checkout code
      uses: actions/checkout@v4
    
    # 2. Configuration Node.js
    - name: ğŸŸ¢ Setup Node.js
      uses: actions/setup-node@v4
      with:
        node-version: '18'
    
    # 3. Installation des dÃ©pendances
    - name: ğŸ“¦ Install dependencies
      run: |
        echo "Installing dependencies..."
        npm install
    
    # 4. Tests (optionnel)
    - name: ğŸ§ª Run tests
      run: |
        echo "Running tests..."
        npm test --if-present
    
    # 5. Build du projet
    - name: ğŸ”¨ Build project
      run: |
        echo "Building project..."
        npm run build --if-present
    
    # 6. Configuration AWS
    - name: âš™ï¸ Configure AWS credentials
      uses: aws-actions/configure-aws-credentials@v4
      with:
        aws-access-key-id: ${{ secrets.AWS_ACCESS_KEY_ID }}
        aws-secret-access-key: ${{ secrets.AWS_SECRET_ACCESS_KEY }}
        aws-region: eu-west-1
    
    # 7. Test des credentials AWS
    - name: ğŸ” Test AWS connection
      run: |
        echo "Testing AWS connection..."
        aws sts get-caller-identity
        aws s3 ls
    
    # 8. DÃ©ploiement
    - name: ğŸš€ Deploy to S3
      run: |
        echo "Deploying to S3..."
        # Remplacez YOUR-BUCKET-NAME par votre nom de bucket
        aws s3 sync ./dist s3://YOUR-BUCKET-NAME --delete
        # ou pour un site statique :
        # aws s3 sync ./ s3://YOUR-BUCKET-NAME --delete --exclude "node_modules/*" --exclude ".git/*"
    
    # 9. Notification de succÃ¨s
    - name: âœ… Deployment successful
      run: |
        echo "ğŸ‰ Deployment completed successfully!"
        echo "Site URL: https://YOUR-BUCKET-NAME.s3-website.eu-west-1.amazonaws.com"
