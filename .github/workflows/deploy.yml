name: Test Node.js Build

on:
  push:
    branches: [main, master]

jobs:
  test:
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v4
    
    - name: Setup Node.js
      uses: actions/setup-node@v4
      with:
        node-version: 18
    
    - name: Check repository content
      run: |
        echo "=== Repository contents ==="
        ls -la
        if [ -f "package.json" ]; then
          echo "‚úÖ package.json found:"
          cat package.json
        else
          echo "‚ùå No package.json found"
        fi
    
    - name: Install dependencies
      run: |
        echo "Installing dependencies..."
        if [ -f "package.json" ]; then
          npm install
          echo "‚úÖ Dependencies installed"
        else
          echo "‚ö†Ô∏è No package.json, skipping npm install"
        fi
    
    - name: Build application
      run: |
        echo "Building application..."
        if [ -f "package.json" ] && npm run build --if-present; then
          echo "‚úÖ Build completed"
        else
          echo "‚ö†Ô∏è No build script or no package.json"
        fi
        
    - name: List output files
      run: |
        echo "=== Final file structure ==="
        ls -la
        if [ -d "dist" ]; then
          echo "=== dist folder ==="
          ls -la dist/
        fi
        if [ -d "build" ]; then
          echo "=== build folder ==="
          ls -la build/
        fi
    
    - name: Ready for deployment
      run: |
        echo "üéâ Build process completed!"
        echo "Next step: Configure AWS secrets and deploy"
